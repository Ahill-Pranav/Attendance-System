<!-- templates/login.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Login</title>
  <link rel="stylesheet" href="/static/css/style.css">
  <style>
    .login-card { max-width: 420px; margin: 110px auto; padding: 28px; text-align:center; }
    .login-card input { width:100%; padding:10px; margin:8px 0; border-radius:8px; border:1px solid #ddd; }
    .login-card .btn { width:100%; }
    .error { color:#b91c1c; margin-top:10px; font-weight:600; padding:10px; border-radius:6px; background:#fee2e2; display:inline-block; }
    .or-sep { margin: 12px 0; color: #666; font-size: 14px; }
    #firebase-btn { display:flex; justify-content:center; margin-top:8px; }
    .muted { font-size:13px; color:#666; margin-top:12px; }
  </style>

  <!-- Firebase JS SDK (compat for simple integration) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
</head>
<body>
  <div class="dashboard-card login-card">
    <h1>Smart Attendance â€” Login</h1>

    <!-- Email fallback form -->
    <form id="emailForm" method="post" action="/login" style="margin-bottom:8px;">
      <input name="email" placeholder="Enter your email (use ROLE_MAPPING)" required />
      <button type="submit" class="btn btn-primary" style="margin-top:10px">Sign In</button>
    </form>

    <div class="or-sep">OR</div>

    <!-- Firebase Google Sign-in button -->
    <div id="firebase-btn">
      <button class="btn btn-primary" onclick="signInWithGoogle()" style="display:inline-flex; align-items:center; gap:8px;">
        <svg width="18" height="18" viewBox="0 0 533.5 544.3" xmlns="http://www.w3.org/2000/svg" aria-hidden>
          <path fill="#EA4335" d="M533.5 278.4c0-17.4-1.6-34.4-4.6-50.8H272v96.3h146.9c-6.3 34-25 62.8-53.6 82v68.2h86.6c50.6-46.6 80.6-115.6 80.6-195.7z"/>
          <path fill="#34A853" d="M272 544.3c72.6 0 133.6-24 178.1-65.1l-86.6-68.2c-24 16.1-54.8 25.6-91.5 25.6-70.4 0-130-47.5-151.3-111.1H35.9v69.9C80.2 481 168.6 544.3 272 544.3z"/>
          <path fill="#4A90E2" d="M120.7 325.5c-9.6-28.4-9.6-58.9 0-87.3V168.3H35.9c-39 78.3-39 170.2 0 248.5l84.8-91.3z"/>
          <path fill="#FBBC05" d="M272 107.7c39.8 0 75.5 13.7 103.7 40.8l77.8-77.8C403.9 24.9 343 0 272 0 168.6 0 80.2 63.3 35.9 168.3l84.8 69.9C142 155.2 201.6 107.7 272 107.7z"/>
        </svg>
        Continue with Google
      </button>
    </div>

    {% if error is defined and error %}
      <div class="error" role="alert">{{ error }}</div>
    {% endif %}

    <div class="muted">
      {% if firebase_available %}
        Firebase sign-in is enabled.
      {% else %}
        Firebase sign-in is NOT configured on the server. Place service account JSON at <code>{{ FIREBASE_JSON }}</code> and restart.
      {% endif %}
    </div>

  </div>

<script>
  // === Replace with your Firebase web app config (from Firebase console) ===
  // Get this from Firebase Console -> Project settings -> SDK setup and config -> Firebase JS SDK snippet
  const firebaseConfig = {
  apiKey: "AIzaSyAPn3WNm3Jc0Gmqdg2dOta_UAqRwWh237E",
  authDomain: "smart-attendance-4e71f.firebaseapp.com",
  projectId: "smart-attendance-4e71f",
  storageBucket: "smart-attendance-4e71f.firebasestorage.app",
  messagingSenderId: "451134242108",
  appId: "1:451134242108:web:cf9b668dc774dba171f239",
  measurementId: "G-G4SDFE0490"
};  // ... other config keys (messagingSenderId, appId etc.)
  // =====================================================================
  // Initialize Firebase client
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  async function signInWithGoogle() {
    try {
      const provider = new firebase.auth.GoogleAuthProvider();
      const result = await auth.signInWithPopup(provider);
      const idToken = await result.user.getIdToken();
      // send Firebase ID token to backend
      const res = await fetch('/google_login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token: idToken })
      });
      const data = await res.json();
      if (data.success && data.redirect) {
        window.location = data.redirect;
      } else {
        alert(data.msg || "Login failed");
      }
    } catch (err) {
      console.error("Firebase sign-in error:", err);
      alert("Sign-in failed: " + (err.message || err));
    }
  }
</script>
</body>
</html>
